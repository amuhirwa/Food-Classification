<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Food Classification MLOps Dashboard</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Header Section -->
    <div class="header">
      <div class="header-content">
        <h1><i class="fas fa-brain"></i> Food Classification MLOps</h1>
        <p>Next-generation AI monitoring and prediction platform</p>
      </div>
    </div>

    <div class="container">
      <!-- System Status -->
      <div class="dashboard-grid">
        <div class="card">
          <h3><i class="fas fa-chart-line"></i> System Status</h3>
          <div class="metric">
            <span class="metric-label">Model Status:</span>
            <span class="metric-value">
              <span
                class="status-indicator status-online"
                id="model-status-indicator"
              ></span>
              <span id="model-status">Loading...</span>
            </span>
          </div>
          <div class="metric">
            <span class="metric-label">Uptime:</span>
            <span class="metric-value" id="uptime">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Total Predictions:</span>
            <span class="metric-value" id="total-predictions">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Success Rate:</span>
            <span class="metric-value" id="success-rate">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Last Prediction:</span>
            <span class="metric-value" id="last-prediction">-</span>
          </div>
        </div>

        <div class="card">
          <h3><i class="fas fa-robot"></i> Model Information</h3>
          <div class="metric">
            <span class="metric-label">Model Type:</span>
            <span class="metric-value" id="model-type">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Classes:</span>
            <span class="metric-value" id="num-classes">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Parameters:</span>
            <span class="metric-value" id="total-parameters">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Input Shape:</span>
            <span class="metric-value" id="input-shape">-</span>
          </div>
          <!-- Current Model Version Display -->
          <div id="current-model-info"></div>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-container">
        <div class="tabs">
          <div class="tab active" onclick="switchTab('prediction')">
            <i class="fas fa-magic"></i> Prediction
          </div>
          <div class="tab" onclick="switchTab('visualization')">
            <i class="fas fa-chart-pie"></i> Analytics
          </div>
          <div class="tab" onclick="switchTab('training')">
            <i class="fas fa-rocket"></i> Training
          </div>
          <div class="tab" onclick="switchTab('monitoring')">
            <i class="fas fa-monitor-waveform"></i> Monitoring
          </div>
          <div class="tab" onclick="switchTab('models')">
            <i class="fas fa-cogs"></i> Models
          </div>
        </div>
      </div>

      <!-- Prediction Tab -->
      <div id="prediction-tab" class="tab-content">
        <div class="dashboard-grid">
          <div class="card">
            <h3><i class="fas fa-camera"></i> Single Image Prediction</h3>

            <!-- Model Version Selector for Predictions -->
            <div class="model-selector-container">
              <label for="prediction-model-selector">Use Model Version:</label>
              <select
                id="prediction-model-selector"
                onchange="handlePredictionModelChange()"
              >
                <option value="current">Current Active Model</option>
                <option value="latest">Latest Model</option>
              </select>
              <small class="model-selector-help"
                >Select which model version to use for predictions</small
              >
            </div>

            <div
              class="upload-area"
              id="single-upload"
              onclick="document.getElementById('single-file').click()"
            >
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Drop your image here or click to browse</p>
              <input
                type="file"
                id="single-file"
                accept="image/*"
                style="display: none"
                onchange="handleSingleUpload(this)"
              />
            </div>
            <div id="single-prediction-result" class="hidden"></div>
          </div>

          <div class="card">
            <h3><i class="fas fa-images"></i> Batch Prediction</h3>
            <div
              class="upload-area"
              id="batch-upload"
              onclick="document.getElementById('batch-files').click()"
            >
              <i class="fas fa-layer-group"></i>
              <p>Upload multiple images for batch processing</p>
              <input
                type="file"
                id="batch-files"
                accept="image/*"
                multiple
                style="display: none"
                onchange="handleBatchUpload(this)"
              />
            </div>
            <div id="batch-file-list" class="file-list hidden"></div>
            <button
              class="btn"
              id="batch-predict-btn"
              onclick="predictBatch()"
              disabled
            >
              <i class="fas fa-play"></i> Process Batch
            </button>
            <div id="batch-prediction-results" class="hidden"></div>
          </div>
        </div>
      </div>

      <!-- Visualization Tab -->
      <div id="visualization-tab" class="tab-content hidden">
        <div class="dashboard-grid">
          <div class="card">
            <h3><i class="fas fa-pie-chart"></i> Class Distribution</h3>
            <div class="chart-container">
              <canvas id="class-distribution-chart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-chart-bar"></i>Retrain Data Distribution</h3>
            <div class="chart-container">
              <canvas id="confidence-chart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-clock"></i> Predictions Timeline</h3>
            <div class="chart-container">
              <canvas id="time-chart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-bullseye"></i> Performance Metrics</h3>
            <div id="performance-metrics"></div>
          </div>
        </div>
      </div>

      <!-- Training Tab -->
      <div id="training-tab" class="tab-content hidden">
        <div class="dashboard-grid">
          <div class="card">
            <h3><i class="fas fa-database"></i> Training Data Upload</h3>
            <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 1rem">
              Upload a ZIP file containing organized training data. The ZIP
              should contain folders named after the classes of your model, such
              as:
              <strong>Bread</strong>, <strong>Dairy product</strong>,
              <strong>Dessert</strong>, <strong>Egg</strong>,
              <strong>Fried food</strong>, <strong>Meat</strong>,
              <strong>Noodles-Pasta</strong>, <strong>Rice</strong>,
              <strong>Seafood</strong>, <strong>Soup</strong>,
              <strong>Vegetable-Fruit</strong>.
            </p>
            <div
              class="upload-area"
              id="training-upload"
              onclick="document.getElementById('training-file').click()"
            >
              <i class="fas fa-file-archive"></i>
              <p>Drop your ZIP file here or click to browse</p>
              <input
                type="file"
                id="training-file"
                accept=".zip"
                style="display: none"
                onchange="handleTrainingUpload(this)"
              />
            </div>
            <div id="training-upload-result" class="hidden"></div>
          </div>

          <div class="card">
            <h3><i class="fas fa-rocket"></i> Model Retraining</h3>
            <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 1rem">
              Trigger model retraining with uploaded data
            </p>
            <button
              class="btn btn-success"
              id="retrain-btn"
              onclick="triggerRetraining()"
            >
              <i class="fas fa-play"></i> Start Retraining
            </button>
            <div id="retraining-status" class="hidden"></div>
            <div id="model-switch-loading" class="hidden"></div>
          </div>

          <div class="card">
            <h3><i class="fas fa-history"></i> Training History</h3>
            <div id="training-history"></div>
          </div>
        </div>
      </div>

      <!-- Monitoring Tab -->
      <div id="monitoring-tab" class="tab-content hidden">
        <div class="dashboard-grid">
          <div class="card">
            <h3><i class="fas fa-list"></i> Recent Predictions</h3>
            <div id="recent-predictions"></div>
          </div>

          <div class="card">
            <h3><i class="fas fa-download"></i> Export Data</h3>
            <button class="btn btn-success" onclick="downloadLogs()">
              <i class="fas fa-file-csv"></i> Download CSV
            </button>
          </div>

          <div class="card">
            <h3><i class="fas fa-tools"></i> System Actions</h3>
            <button class="btn" onclick="refreshData()">
              <i class="fas fa-sync-alt"></i> Refresh Data
            </button>
            <button class="btn btn-danger" onclick="clearLogs()">
              <i class="fas fa-trash"></i> Clear Logs
            </button>
          </div>

          <div class="card">
            <h3><i class="fas fa-code"></i> API Endpoints</h3>
            <div id="api-endpoints"></div>
          </div>
        </div>
      </div>

      <!-- New Models Tab -->
      <div id="models-tab" class="tab-content hidden">
        <div class="dashboard-grid">
          <div class="card">
            <h3><i class="fas fa-brain"></i> Current Active Model</h3>
            <div id="models-tab-current-model-info"></div>
          </div>
          <div class="card">
            <h3><i class="fas fa-list-alt"></i> Available Model Versions</h3>
            <div style="overflow-x: auto">
              <table style="width: 100%; color: rgba(255, 255, 255, 0.9)">
                <thead>
                  <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.2)">
                    <th style="padding: 1rem; text-align: left">Version</th>
                    <th style="padding: 1rem; text-align: left">Size</th>
                    <th style="padding: 1rem; text-align: left">Created</th>
                    <th style="padding: 1rem; text-align: left">Classes</th>
                    <th style="padding: 1rem; text-align: left">Action</th>
                  </tr>
                </thead>
                <tbody id="model-versions-table-body">
                  <!-- Model versions will be populated here -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-exchange-alt"></i> Model Version Control</h3>
            <div class="model-selector-container">
              <label for="model-version-selector">Switch Active Model:</label>
              <select id="model-version-selector">
                <!-- Options will be populated dynamically -->
              </select>
              <small class="model-selector-help"
                >Select a different model version to make it active</small
              >
            </div>
            <button
              class="btn btn-primary"
              onclick="window.modelVersionManager.switchModelVersion(document.getElementById('model-version-selector').value)"
            >
              <i class="fas fa-sync-alt"></i> Switch Model
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="refreshData()" title="Refresh All Data">
      <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Scripts -->
    <script src="model-version-manager.js"></script>
    <script src="dashboard.js"></script>

    <!-- Additional Script for Global Functions -->
    <script>
      // Additional initialization for model selector in prediction tab
      function handlePredictionModelChange() {
        if (window.modelVersionManager) {
          window.modelVersionManager.handlePredictionModelChange();
        }
      }

      // Update tab switching to include models tab
      function switchTab(tabName) {
        if (window.dashboard) {
          window.dashboard.switchTab(tabName);

          // Special handling for models tab
          if (tabName === "models" && window.modelVersionManager) {
            window.modelVersionManager.loadModelVersions();
          }
        }
      }
    </script>
  </body>
</html>
